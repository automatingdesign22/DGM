# A Novel Deep Generative Model based on Imaginal Thinking for Automating Design
Created by Lei Huang, Yuehong Yin, S.K.Ong

## Introduction
This work is based on our CIRP 2022 paper: A Novel Deep Generative Model based on Imaginal Thinking for Automating Design. 
We proposed a deep generative model (DGM) model based on imaginal thinking to solve an engineering design problem.
The current build is a demo for wheel optimization. The nightly full release would be published asap.


## Dependencies
### Requirements:
- Python 2.7+ with Numpy, Scipy and Matplotlib
- [Tensorflow-GPU (version 1.10+)]
- [TFLearn]

Our code has been tested with Python 2.7.18, TensorFlow 1.12.0, TFLearn 0.3.2, CUDA 9.0 and cuDNN 7.6.5 on Ubuntu 18.0.

## Performance

We use the network to automatically design an optimized screw-propelled wheel. By theoretical calculating, the mechanical properties of the optimized screw-propelled wheel are greatly improved compared with the normal screw-propelled wheel: the lift is significantly increased (5.2 N to 24.2 N), and the thrust is increased more than 15% (16 N to 18.5N). 

![image](https://github.com/automatingdesign22/DGM/blob/master/img/wheeltest.png)

![image](https://github.com/automatingdesign22/DGM/blob/master/img/experimental%20result.png)

The experimental process is illustrated in the video folder:
[Experimental video](https://github.com/automatingdesign22/DGM/blob/master/video/Experiment.mp4).

https://user-images.githubusercontent.com/97268100/149090918-c62e6cd1-e28b-4d9c-9241-f9ccdadfd6bc.mp4

In order to validate the generalization ability among various product design problems, the proposed DGM was tested on the open-source Shape-net dataset. The test results are shown in the Table. The accuracy of segementation is shown in [log.txt](https://github.com/automatingdesign22/DGM/blob/master/log.txt).

![image](https://github.com/automatingdesign22/DGM/blob/master/img/accuracy.png)

## Model
The network integrates a Variational Autoencoder (VAE) and a Wasserstein Generative Adversarial Networks (WGAN). 
The structure of VAE integrates a segmentation module on the basis of Pointnet to modify the specified design parameters. We add a step after WGAN: the calculation and evaluation of process variables. This step is to verify that the samples generated by the WGAN Generator can meet the constraints of process variables from the design requirements (such as physical properties, technologic parameters). The model parameters are shown in：
[Base Model](https://github.com/automatingdesign22/DGM/blob/master/Base%20model.txt).


![image](https://github.com/automatingdesign22/DGM/blob/master/img/structure.png)

## Data Set
Due to the attachment size limit, we only uploaded a part of the self-built data set. We generated around 9000 point clouds of the screw-propelled wheels as training data by randomly generating different generatrix, and each data was segmented according to screw cylinder and screw blade. You can email me: hl_18sjtu@sjtu.edu.cn for the full data set.
For the open-source Shape-net dataset, you can git clone
```
cd ./download_data.sh
```
You need download the [hdf5_data and PartAnnotation](http://web.stanford.edu/~ericyi/project_page/part_annotation/index.html). 
ShapeNetPart dataset (around 1.08GB) and HDF5 files (around 346MB).

To be able to train your own model you need first to _compile_ the EMD/Chamfer losses. In /external/structural_losses 
```
cd /external

make
```

## Usage
For the "a type of wheel that runs in granular meida, run smoothly, and have strong stiffness"：

```
Python ex1-1.py
```
Then the result is shown in ex1_1.ply.

For the "a type of wheel that runs in granular, has strong traction capacity, runs smoothly, and has strong stiffness"：

```
Python ex1-2.py
```
Then the result is shown in ex1_2.ply.

To test the segmentation: 
```
Python ex1-seg.py
```
Then the result is shown in test_resultswheel.


To test the open-source dataset:

```
Python ex2.py
```
Then the result is shown in ex2_results.


To test the L-WGAN which use "function requirment" as input:
```
python gan_test.py
```

The result is shown in try(0-4).py, totally 5 samples.

To train a VAE on your own dataset:
```
python train.py
```

To train a multi-object VAE:
```
python train-shapenet.py
```
To train a WGAN:
```
python gan_train.py
```
